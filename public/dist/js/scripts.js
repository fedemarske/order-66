var App=function(t,i){var e,n=function(){var n;t("ul.main-list-items").sortable({group:"simple_with_animation",pullPlaceholder:!1,nested:!1,onDrop:function(n,s,a){var r=t("<li/>").css({height:0});n.before(r),r.animate({height:n.height()}),n.animate(r.position(),function(){r.detach(),a(n,s)});var o=[];s.el.find("li.item").each(function(){var i={description:t(this).data().description,img:t(this).data().imgSrc,uid:t(this).data().uid};o.push(i)}),e.items=o,i.rm("items-list"),i.set("items-list",o)},onDragStart:function(t,i,e){var s=t.offset(),a=i.rootGroup.pointer;n={left:a.left-s.left,top:a.top-s.top},e(t,i)},onDrag:function(t,i){t.css({left:i.left-n.left,top:i.top-n.top})}})};return{init:function(){e=new App.List,App.Modal.init(e),t("#main-list").append(e.create()),n(),t("#counter").text(e.getCounter()),t("#add-item-btn").click(function(){App.Modal.open(!1)})}}}(jQuery,Lockr);!function(t,i,e){"use strict";function n(t,i){this.description=t.description,this.imgSrc=-1!==t.img.indexOf("data:image/png;base64,")?t.img:"data:image/png;base64,"+t.img,this.uid=t.uid||"",this.list=i,this.createDom()}n.prototype.create=function(){return this.el.append(this.img),this.el.append(this.span),this.el.append(this.btnBlock),this.el.addClass("item"),this.el},n.prototype.createDom=function(){this.el=t("<li>"),this.el.data(this),this.img=t("<img>").addClass("list-img").attr({src:this.imgSrc,width:"130px",heigth:"100px"}),this.span=t("<span>").text(this.description),this.edit=t("<button>").text("Edit").click(this.editHandler.bind(this)),this.delete=t("<button>").text("Delete").click(this.deleteHandler.bind(this)),this.btnBlock=t("<div>").addClass("btn-group").append(this.edit,this.delete)},n.prototype.editHandler=function(){i.Modal.open(!0,this)},n.prototype.deleteHandler=function(){var t=this.list.items,i=t.map(function(t){return t.uid}).indexOf(this.uid);t.splice(i,1),e.rm("items-list"),e.set("items-list",t),this.list.reRender()},n.prototype.editItem=function(t,i){var n=this.list.items,s=n.map(function(t){return t.uid}).indexOf(this.uid);n[s].img=t,n[s].description=i,e.rm("items-list"),e.set("items-list",n),this.list.reRender()},i.Item=n}(jQuery,App,Lockr),function(t,i,e){"use strict";function n(){this.items=this.getItems(),this.el=t("<ul>").addClass("main-list-items")}n.prototype.getItems=function(){return void 0===e.get("items-list")&&e.set("items-list",[]),e.get("items-list")},n.prototype.create=function(){return t.each(this.items,function(t,e){var n=new i.Item(e,this);this.el.append(n.create())}.bind(this)),this.el},n.getInstance=function(){return this},n.prototype.getCounter=function(){return this.items.length},n.prototype.addItem=function(t){this.items.push(t),e.set("items-list",this.items),this.reRender()},n.prototype.reRender=function(){this.el.html(""),this.create(),t("#counter").text(this.getCounter())},n.prototype.cleanList=function(){this.items=[]},i.List=n}(jQuery,App,Lockr),function(t,i){function e(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}var n,s,a,r,o,c,l,d=function(){if(c||0===a.attr("src").length||0===r.val().length)alert("Invalid Form");else{if(editMode)l.editItem(m(a[0]),r.val());else{var t={uid:e(),description:r.val(),img:m(a[0])};o.addItem(t)}p()}},h=function(){s.val(""),a.attr("src","http://via.placeholder.com/320x320"),r.val("")},p=function(){h(),n.hide()},u=function(t){var i=t.target.files,e=new Image;if(!i[0].name.match(/.(jpg|jpeg|png|gif)$/i))return alert("not an image"),s.val(""),!1;e.src=window.URL.createObjectURL(i[0]),e.onload=function(){var t=e.naturalWidth,n=e.naturalHeight;if(window.URL.revokeObjectURL(e.src),t<=320&&n<=320){if(FileReader&&i&&i.length){var r=new FileReader;r.onload=function(){a.attr("src",r.result)},r.readAsDataURL(i[0])}}else alert("image with more than 320x320px"),s.val("")}},m=function(t){var i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0),i.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")};i.Modal={init:function(i){n=t("#add-item-modal"),s=t("#img-input-item"),a=t("#img-tag-item"),r=t("#desc-item"),o=i,c=!1,editMode=!1,l={},t("#btn-cancel-modal").click(p),window.onclick=function(t){t.target==n[0]&&p()}.bind(this),t("#btn-submit-modal").click(d),t("#img-anchor-item").click(function(){s.click()}.bind(this)),s.on("change",u.bind(this)),t("textarea[maxlength]").on("propertychange input",function(){this.value.length>this.maxlength?(this.value=this.value.substring(0,this.maxlength),alert("300 max characters"),c=!0):c=!1})},getEl:function(){return n},open:function(t,i){t&&(r.val(i.description),a.attr("src",i.imgSrc),c=!1,editMode=t,l=i),n.show()}}}(jQuery,App);